<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Examples for using the system catalogs &#8212; PyGreSQL 6.1.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=6340cb70"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Examples" href="../examples.html" />
    <link rel="prev" title="Examples for using SQL functions" href="func.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="examples-for-using-the-system-catalogs">
<h1>Examples for using the system catalogs<a class="headerlink" href="#examples-for-using-the-system-catalogs" title="Link to this heading">¶</a></h1>
<p>The system catalogs are regular tables where PostgreSQL stores schema metadata,
such as information about tables and columns, and internal bookkeeping
information. You can drop and recreate the tables, add columns, insert and
update values, and severely mess up your system that way. Normally, one
should not change the system catalogs by hand: there are SQL commands
to make all supported changes.  For example, CREATE DATABASE inserts a row
into the <em>pg_database</em> catalog — and actually creates the database on disk.</p>
<p>It this section we want to show examples for how to parse some of the system
catalogs, making queries with the classic PyGreSQL interface.</p>
<p>We assume that you have already created a connection to the PostgreSQL
database, as explained in the <a class="reference internal" href="basic.html"><span class="doc">Basic examples</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pg</span> <span class="kn">import</span> <span class="n">DB</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span>
</pre></div>
</div>
<section id="lists-indices">
<h2>Lists indices<a class="headerlink" href="#lists-indices" title="Link to this heading">¶</a></h2>
<p>This query lists all simple indices in the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT bc.relname AS class_name,</span>
<span class="s2">        ic.relname AS index_name, a.attname</span>
<span class="s2">    FROM pg_class bc, pg_class ic, pg_index i, pg_attribute a</span>
<span class="s2">    WHERE i.indrelid = bc.oid AND i.indexrelid = ic.oid</span>
<span class="s2">        AND i.indkey[0] = a.attnum AND a.attrelid = bc.oid</span>
<span class="s2">        AND NOT a.attisdropped AND a.attnum&gt;0</span>
<span class="s2">    ORDER BY class_name, index_name, attname&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="list-user-defined-attributes">
<h2>List user defined attributes<a class="headerlink" href="#list-user-defined-attributes" title="Link to this heading">¶</a></h2>
<p>This query lists all user-defined attributes and their types
in user-defined tables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT c.relname, a.attname,</span>
<span class="s2">        format_type(a.atttypid, a.atttypmod)</span>
<span class="s2">    FROM pg_class c, pg_attribute a</span>
<span class="s2">    WHERE c.relkind = &#39;r&#39; AND c.relnamespace!=ALL(ARRAY[</span>
<span class="s2">        &#39;pg_catalog&#39;,&#39;pg_toast&#39;, &#39;information_schema&#39;]::regnamespace[])</span>
<span class="s2">        AND a.attnum &gt; 0</span>
<span class="s2">        AND a.attrelid = c.oid</span>
<span class="s2">        AND NOT a.attisdropped</span>
<span class="s2">    ORDER BY relname, attname&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="list-user-defined-base-types">
<h2>List user defined base types<a class="headerlink" href="#list-user-defined-base-types" title="Link to this heading">¶</a></h2>
<p>This query lists all user defined base types:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT r.rolname, t.typname</span>
<span class="s2">    FROM pg_type t, pg_authid r</span>
<span class="s2">    WHERE r.oid = t.typowner</span>
<span class="s2">        AND t.typrelid = &#39;0&#39;::oid and t.typelem = &#39;0&#39;::oid</span>
<span class="s2">        AND r.rolname != &#39;postgres&#39;</span>
<span class="s2">    ORDER BY rolname, typname&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="list-operators">
<h2>List operators<a class="headerlink" href="#list-operators" title="Link to this heading">¶</a></h2>
<p>This query lists all right-unary operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT o.oprname AS right_unary,</span>
<span class="s2">        lt.typname AS operand, result.typname AS return_type</span>
<span class="s2">    FROM pg_operator o, pg_type lt, pg_type result</span>
<span class="s2">    WHERE o.oprkind=&#39;r&#39; and o.oprleft = lt.oid</span>
<span class="s2">        AND o.oprresult = result.oid</span>
<span class="s2">    ORDER BY operand&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This query lists all left-unary operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT o.oprname AS left_unary,</span>
<span class="s2">        rt.typname AS operand, result.typname AS return_type</span>
<span class="s2">    FROM pg_operator o, pg_type rt, pg_type result</span>
<span class="s2">    WHERE o.oprkind=&#39;l&#39; AND o.oprright = rt.oid</span>
<span class="s2">        AND o.oprresult = result.oid</span>
<span class="s2">    ORDER BY operand&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>And this one lists all of the binary operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT o.oprname AS binary_op,</span>
<span class="s2">        rt.typname AS right_opr, lt.typname AS left_opr,</span>
<span class="s2">        result.typname AS return_type</span>
<span class="s2">    FROM pg_operator o, pg_type rt, pg_type lt, pg_type result</span>
<span class="s2">    WHERE o.oprkind = &#39;b&#39; AND o.oprright = rt.oid</span>
<span class="s2">        AND o.oprleft = lt.oid AND o.oprresult = result.oid&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="list-functions-of-a-language">
<h2>List functions of a language<a class="headerlink" href="#list-functions-of-a-language" title="Link to this heading">¶</a></h2>
<p>Given a programming language, this query returns the name, args and return
type from all functions of a language:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;sql&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT p.proname, p.pronargs, t.typname</span>
<span class="s2">    FROM pg_proc p, pg_language l, pg_type t</span>
<span class="s2">    WHERE p.prolang = l.oid AND p.prorettype = t.oid</span>
<span class="s2">        AND l.lanname = $1</span>
<span class="s2">    ORDER BY proname&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">language</span><span class="p">,)))</span>
</pre></div>
</div>
</section>
<section id="list-aggregate-functions">
<h2>List aggregate functions<a class="headerlink" href="#list-aggregate-functions" title="Link to this heading">¶</a></h2>
<p>This query lists all of the aggregate functions and the type to which
they can be applied:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT p.proname, t.typname</span>
<span class="s2">    FROM pg_aggregate a, pg_proc p, pg_type t</span>
<span class="s2">    WHERE a.aggfnoid = p.oid</span>
<span class="s2">        and p.proargtypes[0] = t.oid</span>
<span class="s2">    ORDER BY proname, typname&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="list-operator-families">
<h2>List operator families<a class="headerlink" href="#list-operator-families" title="Link to this heading">¶</a></h2>
<p>The following query lists all defined operator families and all the operators
included in each family:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT am.amname, opf.opfname, amop.amopopr::regoperator</span>
<span class="s2">    FROM pg_am am, pg_opfamily opf, pg_amop amop</span>
<span class="s2">    WHERE opf.opfmethod = am.oid</span>
<span class="s2">        AND amop.amopfamily = opf.oid</span>
<span class="s2">    ORDER BY amname, opfname, amopopr&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/pygresql.png" alt="Logo of PyGreSQL"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">PyGreSQL</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About PyGreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright notice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../download/index.html">Download information</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The PyGreSQL documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#contents">Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">PyGreSQL Development and Support</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">The PyGreSQL documentation</a><ul>
  <li><a href="index.html">A PostgreSQL Primer</a><ul>
      <li>Previous: <a href="func.html" title="previous chapter">Examples for using SQL functions</a></li>
      <li>Next: <a href="../examples.html" title="next chapter">Examples</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, The PyGreSQL team.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../../_sources/contents/postgres/syscat.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>